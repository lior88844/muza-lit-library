import{M as b,u as B,w as K,a as C}from"./musicStore-J3WrqYgq.js";import{o as e,a as c,M as q,L as H,S as Q,p as _,O as W,q as Y}from"./chunk-DQRVZFIR-BNfO-z-U.js";import{F as G,L as J}from"./VolumeControl-DPOKYJYc.js";import{M as Z}from"./MusicSidebar-D2kDi3qV.js";import{M as V}from"./MusicTopbar-BWn972Jc.js";import{u as O}from"./currentPlayerStore-Dqkt8Cds.js";const T={defaultMode:"auto",localStorageKey:"flowbite-theme-mode",prefix:""};function z({mode:t,defaultMode:l=T.defaultMode,localStorageKey:n=T.localStorageKey,...r}){return e.jsx("script",{...r,"data-flowbite-theme-mode-script":!0,dangerouslySetInnerHTML:{__html:U({mode:t,defaultMode:l,localStorageKey:n,prefix:""})}})}z.displayName="ThemeModeScript";function U(t={}){const{mode:l,defaultMode:n=T.defaultMode,localStorageKey:r=T.localStorageKey,prefix:a=T.prefix}=t;return`
    try {
      const storageMode = window.localStorage.getItem("${r}");
      const isStorageModeValid = storageMode === "light" || storageMode === "dark" || storageMode === "auto";
      const resolvedMode = (isStorageModeValid ? storageMode : null) ?? ${l?`"${l}"`:void 0} ?? "${n}";
      const computedMode =
        resolvedMode === "auto" ? (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light") : resolvedMode;

      if (computedMode === "dark") {
        document.documentElement.classList.add("${a}dark");
      } else {
        document.documentElement.classList.remove("${a}dark");
      }
      localStorage.setItem("${r}", resolvedMode);

      // Add listener for system theme changes
      const mediaQuery = window.matchMedia("(prefers-color-scheme: dark)");
      mediaQuery.addEventListener("change", (e) => {
        const storageMode = window.localStorage.getItem("${r}");
        const isStorageModeValid = storageMode === "light" || storageMode === "dark" || storageMode === "auto";
        const resolvedMode = isStorageModeValid ? storageMode : "${n}";

        if (resolvedMode === "auto") {
          if (e.matches) {
            document.documentElement.classList.add("${a}dark");
          } else {
            document.documentElement.classList.remove("${a}dark");
          }
        }
      });

      // Add listener for storage changes
      window.addEventListener("storage", (e) => {
        if (e.key === "${r}") {
          const newMode = e.newValue;
          const isStorageModeValid = newMode === "light" || newMode === "dark" || newMode === "auto";
          const resolvedMode = isStorageModeValid ? newMode : "${n}";

          if (resolvedMode === "dark" || (resolvedMode === "auto" && window.matchMedia("(prefers-color-scheme: dark)").matches)) {
            document.documentElement.classList.add("${a}dark");
          } else {
            document.documentElement.classList.remove("${a}dark");
          }
        }
      });
    } catch (e) {}
  `}const ee=({value:t=75,muted:l=!1,disabled:n=!1,volumeStep:r=1,onVolumeChange:a,noSymbol:f=!1})=>{const[p,d]=c.useState(l),[u,M]=c.useState(!1),x=c.useRef(t),h=c.useRef(null),i=()=>{n||(p?(d(!1),a==null||a(x.current)):(x.current=t,d(!0),a==null||a(0)))},m=()=>p||t===0?"volume-mute":t<50?"volume-down":"volume-up",y=k=>{if(n||!h.current)return;const S=h.current.getBoundingClientRect(),N=8,g=N,E=S.width-N,$=(Math.max(g,Math.min(E,k.clientX-S.left))-g)/(E-g)*100,s=Math.round($/r)*r;d(!1),a==null||a(s)},v=k=>{if(!u||!h.current||n)return;const S=h.current.getBoundingClientRect(),N=8,g=N,E=S.width-N,$=(Math.max(g,Math.min(E,k.clientX-S.left))-g)/(E-g)*100,s=Math.round($/r)*r;a==null||a(s)},o=()=>{n||M(!0)},w=()=>{M(!1)};c.useEffect(()=>(u?(window.addEventListener("mousemove",v),window.addEventListener("mouseup",w)):(window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",w)),()=>{window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",w)}),[u]);const P=k=>8+k*84/100;return e.jsxs("div",{className:`volume-control ${n?"disabled":""}`,children:[!f&&e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-speaker volume-icon",onClick:i}),e.jsx("i",{className:`fa-solid fa-${m()} volume-icon`,onClick:i})]}),e.jsx("div",{className:"slider",ref:h,onClick:y,children:e.jsxs("svg",{viewBox:"0 0 100 24",children:[e.jsx("line",{className:"track",x1:"2",y1:"12",x2:"98",y2:"12"}),e.jsx("line",{className:"fill",x1:"2",y1:"12",x2:P(t),y2:"12"}),e.jsx("circle",{className:"handle",cx:P(t),cy:"12",r:"8",onMouseDown:o})]})})]})},se=({details:t,onPrevious:l,onNext:n,onUpdate:r,onSongEnded:a,setIsPlaying:f,onPlayCountIncrement:p})=>{const d=c.useRef(null),[u,M]=c.useState(0),[x,h]=c.useState(0),[i,m]=c.useState(75),[y,v]=c.useState(!1),[o,w]=c.useState(!1),[P,k]=c.useState(!1),S=s=>{if(!s||isNaN(s)||!isFinite(s))return"0:00";const j=Math.floor(s/60),L=Math.floor(s%60).toString().padStart(2,"0");return`${j}:${L}`},N=u>0?x/u*100:0,g=()=>{const s=d.current;s&&s.play().catch(j=>{console.error("Error playing audio:",j),f(!1),r==null||r({...t})})},E=s=>{m(s),d.current&&(d.current.volume=s/100)},I=s=>{const j=d.current;if(!j||u===0)return;const L=s.currentTarget.getBoundingClientRect(),R=(s.clientX-L.left)/L.width*u;j.currentTime=R,h(R)},$=()=>{if(y)return;const s=!t.isPlaying;f(s),r==null||r({...t})};return c.useEffect(()=>{f(t.isPlaying||!1)},[t.isPlaying]),c.useEffect(()=>{const s=d.current;s&&(t.isPlaying&&!y?g():t.isPlaying||s.pause())},[t.isPlaying,y]),c.useEffect(()=>{const s=d.current;if(!s||!t.audioUrl)return;const j=()=>{M(s.duration),v(!1),t.isPlaying&&g()},L=()=>h(s.currentTime),A=()=>{f(!1),r==null||r({...t}),a==null||a()},R=()=>{f(!0),r==null||r({...t}),p==null||p()},F=()=>{f(!1),r==null||r({...t})},D=()=>v(!0),X=()=>v(!1);return s.addEventListener("loadeddata",j),s.addEventListener("timeupdate",L),s.addEventListener("ended",A),s.addEventListener("play",R),s.addEventListener("pause",F),s.addEventListener("loadstart",D),s.addEventListener("waiting",D),s.addEventListener("canplay",X),s.src=t.audioUrl,s.volume=i/100,s.load(),t.isPlaying&&g(),()=>{s.pause(),s.removeEventListener("loadeddata",j),s.removeEventListener("timeupdate",L),s.removeEventListener("ended",A),s.removeEventListener("play",R),s.removeEventListener("pause",F),s.removeEventListener("loadstart",D),s.removeEventListener("waiting",D),s.removeEventListener("canplay",X)}},[t.audioUrl]),e.jsxs("div",{className:"music-player",children:[e.jsx("audio",{ref:d,hidden:!0}),e.jsxs("div",{className:"player-info",children:[e.jsx("img",{className:"album-art",src:t.imageSrc,alt:`${t.title} album cover`}),e.jsxs("div",{className:"track-info",children:[e.jsx("h3",{className:"track-title",children:t.title}),e.jsx("p",{className:"track-artist",children:t.artist}),e.jsxs("div",{className:"track-details",children:[e.jsx("span",{children:t.album}),e.jsx("span",{className:"separator",children:"â€¢"}),e.jsx("span",{children:t.year})]})]})]}),e.jsxs("div",{className:"player-controls",children:[e.jsxs("div",{className:"progress-section",children:[e.jsx("div",{className:"progress-bar",onClick:I,children:e.jsx("div",{className:"progress-fill",style:{width:`${N}%`}})}),e.jsxs("div",{className:"time-display",children:[e.jsx("span",{children:S(x)}),e.jsx("span",{children:S(u-x)})]})]}),e.jsxs("div",{className:"controls-row",children:[e.jsxs("div",{className:"playback-controls",children:[e.jsx("button",{className:`control-btn shuffle ${o?"active":""}`,onClick:()=>w(!o),"aria-label":"Shuffle",children:e.jsx(b,{iconName:"shuffle"})}),e.jsx("button",{className:"control-btn previous",onClick:l,"aria-label":"Previous track",children:e.jsx(b,{iconName:"skip-back"})}),e.jsx("button",{className:"control-btn play",onClick:$,"aria-label":"Play or pause",children:y?e.jsx(G,{className:"spinner"}):t.isPlaying?e.jsx(b,{iconName:"pause"}):e.jsx(b,{iconName:"play"})}),e.jsx("button",{className:"control-btn next",onClick:n,"aria-label":"Next track",children:e.jsx(b,{iconName:"skip-forward"})}),e.jsx("button",{className:`control-btn repeat ${P?"active":""}`,onClick:()=>k(!P),"aria-label":"Repeat",children:e.jsx(b,{iconName:"repeat"})})]}),e.jsx("div",{className:"volume-section",children:e.jsx(ee,{noSymbol:!0,value:i,onVolumeChange:E})})]})]})]})};function te(){const{recentlyPlayed:t,incrementPlayCount:l}=B(),{selectedSong:n,setSelectedSong:r,isPlaying:a,setIsPlaying:f,playCountIncremented:p,setPlayCountIncremented:d}=O(),u=()=>!n||!n.id?-1:t.findIndex(i=>i.id===n.id),M=()=>{const i=u();let m;i<=0?m=t[t.length-1]:m=t[i-1],r({...m})},x=()=>{const i=u();let m;i===-1||i===t.length-1?m=t[0]:m=t[i+1],r({...m})},h=()=>{n!=null&&n.id&&!p&&(l(n.id),d(!0))};return e.jsx(e.Fragment,{children:n&&e.jsx(se,{details:{audioUrl:n.audioUrl||"",imageSrc:n.imageSrc||"",title:n.title,artist:n.artist||"",album:n.album||"",year:n.year||new Date().getFullYear(),isPlaying:a||!1,id:n.id},setIsPlaying:f,onUpdate:i=>{r({...n,audioUrl:i.audioUrl})},onPrevious:M,onNext:x,onSongEnded:x,onPlayCountIncrement:h})})}const le=()=>[{rel:"preconnect",href:"https://fonts.googleapis.com"},{rel:"preconnect",href:"https://fonts.gstatic.com",crossOrigin:"anonymous"},{rel:"stylesheet",href:"https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"},{rel:"stylesheet",href:"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"}];function de({children:t}){const l=B(d=>d.sidebarSections),[n,r]=c.useState(!0),[a,f]=c.useState(null);c.useEffect(()=>{const{setNewReleases:d,setFeatured:u,setArtists:M,setRecommended:x,setRecentlyPlayed:h,setPlaylists:i,setSidebarSections:m}=B.getState(),{selectedSong:y,setSelectedSong:v}=O.getState();fetch("/staticData/allData.json").then(o=>{if(!o.ok)fetch("./staticData/allData.json").then(w=>{if(!w.ok)throw new Error("Network response was not ok");return w.json()});else return o.json()}).then(o=>{u(o.albums.featured||[]),d(o.albums.newReleases.slice(0,5)||[]),x(o.albums.recommended||[]),M(o.artists),h(o.songs),i(o.playlists||[]),m(o.sidebar.sections),o.songs.length>0&&!y&&v(o.songs[0]),r(!1)}).catch(o=>{f(o.message),r(!1)})},[]);const p=n?e.jsx("p",{children:"Loading..."}):a?e.jsxs("p",{children:["Error: ",a]}):null;return e.jsxs("html",{lang:"en",suppressHydrationWarning:!0,children:[e.jsxs("head",{children:[e.jsx("meta",{charSet:"utf-8"}),e.jsx("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),e.jsx(q,{}),e.jsx(H,{}),e.jsx(z,{})]}),e.jsxs("body",{children:[e.jsxs("div",{className:"body",children:[e.jsx(Z,{logoSrc:"/app/icons/icons/muza.svg",logoAlt:"Music Library",sections:l}),e.jsxs("div",{className:"content",children:[e.jsx(V,{}),p||t,e.jsx(te,{})]})]}),e.jsx(J,{}),e.jsx(Q,{}),e.jsx(_,{})]})]})}const ue=K(function(){return e.jsx(W,{})}),me=C(function({error:l}){let n="Oops!",r="An unexpected error occurred.",a;return Y(l)&&(n=l.status===404?"404":"Error",r=l.status===404?"The requested page could not be found.":l.statusText||r),e.jsxs("main",{className:"container mx-auto p-4 pt-16",children:[e.jsx("h1",{children:n}),e.jsx("p",{children:r}),a]})});export{me as ErrorBoundary,de as Layout,ue as default,le as links};
